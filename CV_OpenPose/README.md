# OpenPose人体姿态估计

基于MediaPipe的轻量级OpenPose实现，用于人体姿态检测和关键点提取。

## 功能特性

- 🎯 **高精度姿态检测**: 检测33个人体关键点
- ⚡ **实时性能**: 支持实时摄像头检测
- 📊 **可视化分析**: 2D姿态可视化和关键点坐标提取
- 🎥 **视频录制**: 支持检测过程录制
- 🔧 **灵活配置**: 支持多种模型复杂度和参数调整

## 项目结构

```
CV_OpenPose/
├── requirements.txt          # 依赖包列表
├── openpose_demo.py         # 静态图像姿态检测演示
├── openpose_realtime.py     # 实时摄像头检测
└── README.md                # 项目说明文档
```

## 安装依赖

```bash
pip install -r requirements.txt
```

### 依赖包说明

- `opencv-python`: 图像处理和摄像头操作
- `mediapipe`: Google的机器学习框架，用于姿态检测
- `numpy`: 数值计算
- `matplotlib`: 数据可视化
- `Pillow`: 图像处理

## 使用方法

### 1. 静态图像检测

```bash
python openpose_demo.py
```

**功能说明:**
- 检测图像中的人体姿态
- 提取33个关键点坐标
- 生成姿态可视化图表
- 保存检测结果图像

**使用步骤:**
1. 将测试图像命名为 `test_image.jpg` 并放在项目目录
2. 运行脚本进行检测
3. 查看生成的检测结果和可视化图表

### 2. 实时摄像头检测

```bash
# 基本使用
python openpose_realtime.py

# 指定摄像头和模型复杂度
python openpose_realtime.py --camera 0 --model 2

# 录制检测视频
python openpose_realtime.py --record --output my_pose_video.mp4

# 不显示详细信息
python openpose_realtime.py --no-info
```

**命令行参数:**
- `--camera`: 摄像头ID (默认: 0)
- `--model`: 模型复杂度 (0=轻量, 1=平衡, 2=高精度, 默认: 2)
- `--record`: 录制视频
- `--output`: 输出视频路径
- `--no-info`: 不显示详细信息

**交互控制:**
- 按 `q` 键退出检测
- 按 `s` 键保存当前帧
- 按 `r` 键开始/停止录制

## 关键点说明

MediaPipe检测33个人体关键点，包括：

### 面部关键点 (0-10)
- 鼻子、眼睛、耳朵、嘴巴等面部特征点

### 上身关键点 (11-22)
- 肩膀、肘部、手腕等上肢关键点
- 手部关键点（拇指、食指、小指等）

### 下身关键点 (23-32)
- 髋部、膝盖、脚踝等下肢关键点
- 脚部关键点（脚跟、脚趾等）

## 技术实现

### 核心类说明

#### OpenPoseDetector
静态图像姿态检测器
- `detect_pose()`: 检测图像中的人体姿态
- `get_landmark_coordinates()`: 获取关键点坐标
- `visualize_pose_2d()`: 2D姿态可视化

#### RealTimeOpenPose
实时摄像头检测器
- `process_frame()`: 处理单帧图像
- `calculate_fps()`: 计算实时FPS
- `run()`: 运行实时检测循环

### 性能优化

1. **模型复杂度选择**:
   - 复杂度0: 最快，适合实时应用
   - 复杂度1: 平衡性能和精度
   - 复杂度2: 最高精度，适合离线分析

2. **检测参数调优**:
   - `min_detection_confidence`: 最小检测置信度
   - `min_tracking_confidence`: 最小跟踪置信度

## 应用场景

- 🏃‍♂️ **运动分析**: 健身动作检测和纠正
- 🎭 **动作捕捉**: 游戏和动画制作
- 🏥 **医疗康复**: 康复训练监测
- 🎮 **人机交互**: 手势识别和控制
- 📊 **行为分析**: 人群行为模式研究

## 输出示例

### 检测结果图像
- 原始图像 + 姿态骨架叠加
- 关键点标注和连接线
- 置信度信息显示

### 关键点坐标
```
关键点坐标:
 0. 鼻子    : ( 640,  200)
 1. 左眼内角: ( 620,  190)
 2. 左眼    : ( 610,  185)
 ...
```

### 可视化图表
- 2D散点图显示关键点分布
- 骨架连接线显示人体结构
- 坐标轴标注便于分析

## 注意事项

1. **摄像头权限**: 确保程序有摄像头访问权限
2. **光照条件**: 良好的光照条件有助于提高检测精度
3. **人体可见性**: 确保人体关键部位在摄像头视野内
4. **性能要求**: 高复杂度模型需要较好的硬件支持

## 故障排除

### 常见问题

1. **摄像头无法打开**
   - 检查摄像头是否被其他程序占用
   - 尝试不同的摄像头ID (0, 1, 2...)

2. **检测精度低**
   - 调整光照条件
   - 增加模型复杂度
   - 调整检测置信度参数

3. **性能问题**
   - 降低模型复杂度
   - 减小输入图像尺寸
   - 关闭不必要的可视化功能

## 扩展功能

### 自定义关键点连接
可以修改 `POSE_CONNECTIONS` 来定义自定义的骨架连接关系。

### 多人体检测
MediaPipe支持多人检测，可以扩展代码以处理多个人体实例。

### 3D姿态估计
结合深度信息可以实现3D姿态估计。

## 许可证

本项目基于MIT许可证开源。

## 贡献

欢迎提交Issue和Pull Request来改进项目！

## 联系方式

如有问题或建议，请通过GitHub Issues联系。
